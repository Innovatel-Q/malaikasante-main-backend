openapi: 3.0.0
info:
  title: Admin Doctors Documents Management API
  description: Gestion compl√®te des documents m√©dicaux avec libell√©s personnalis√©s par les administrateurs
  version: 1.0.0

paths:
  /v1/admin/doctors/{medecinId}/documents:
    put:
      tags:
        - Administration
      summary: G√©rer les documents d'un m√©decin avec libell√©s personnalis√©s
      description: |
        API unifi√©e pour la gestion compl√®te des documents m√©dicaux avec libell√©s personnalis√©s.
        
        **üóÇÔ∏è Actions disponibles :**
        - ‚ûï **ADD** : Ajouter un nouveau document avec libell√© personnalis√©
        - ‚úèÔ∏è **UPDATE** : Modifier libell√©, description ou remplacer le fichier
        - üóëÔ∏è **DELETE** : Supprimer document et fichier physique
        - üìã **LIST** : Lister tous les documents du m√©decin
        
        **üìÅ Types de documents :**
        - **DIPLOME** : Dipl√¥mes universitaires, certificats d'√©tudes
        - **CERTIFICATION** : Certificats d'inscription √† l'ordre, formations continues
        - **AUTRE** : Tout autre document m√©dical pertinent
        
        **üè∑Ô∏è Libell√©s personnalis√©s :**
        - Libell√© obligatoire pour chaque document
        - Description optionnelle pour plus de d√©tails
        - Tra√ßabilit√© compl√®te (qui, quand, depuis quelle IP)
        
        **üõ°Ô∏è S√©curit√© et stockage :**
        - **Formats accept√©s** : PDF, JPG, PNG uniquement
        - **Taille maximale** : 10MB par fichier
        - **Stockage** : Local s√©curis√© ou service externe (selon config)
        - **Acc√®s** : Authentifi√© et trac√© pour audit
        
        **üìä Workflow typique :**
        1. **ADD** : Admin upload document avec libell√© descriptif
        2. **LIST** : Visualisation de tous les documents du m√©decin
        3. **UPDATE** : Modification libell√© ou remplacement fichier si n√©cessaire
        4. **DELETE** : Suppression si document incorrect ou obsol√®te
        
        **‚ö†Ô∏è Contraintes importantes :**
        - Seuls les m√©decins EN_ATTENTE peuvent recevoir de nouveaux documents
        - Suppression physique automatique du fichier lors de DELETE
        - Tous les champs libelle/description sont modifiables
        - Changement de type possible (DIPLOME ‚Üí CERTIFICATION, etc.)
        
        **User Stories :** Admin-US6, US7 (Gestion documents m√©dicaux)

      security:
        - bearerAuth: []
      
      parameters:
        - name: medecinId
          in: path
          description: ID unique du m√©decin concern√©
          required: true
          schema:
            type: string
            format: uuid
            example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"

      requestBody:
        required: true
        description: |
          **Structure variable selon l'action** :
          
          - **ADD** : `action` + `libelle` + `type` + `document` (fichier) + `description` (optionnel)
          - **UPDATE** : `action` + `documentId` + champs √† modifier + `document` (optionnel si remplacement)
          - **DELETE** : `action` + `documentId`
          - **LIST** : `action` uniquement
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  enum: [ADD, UPDATE, DELETE, LIST]
                  description: |
                    Action √† effectuer sur les documents
                    
                    **Actions :**
                    - **ADD** : Ajouter un nouveau document
                    - **UPDATE** : Modifier un document existant
                    - **DELETE** : Supprimer un document
                    - **LIST** : Lister tous les documents
                  example: "ADD"
                
                documentId:
                  type: string
                  description: |
                    ID du document √† modifier ou supprimer
                    
                    **Requis pour :** UPDATE, DELETE
                    **Format :** ID du fichier retourn√© lors de l'upload
                  example: "a1b2c3d4e5f67890abcdef1234567890"
                
                libelle:
                  type: string
                  minLength: 3
                  maxLength: 200
                  description: |
                    Libell√© descriptif personnalis√© du document
                    
                    **Requis pour :** ADD
                    **Optionnel pour :** UPDATE (si modification souhait√©e)
                    **Exemples :**
                    - "Dipl√¥me de Docteur en M√©decine - Universit√© d'Abidjan"
                    - "Certificat d'inscription √† l'Ordre des M√©decins 2023"
                    - "Formation continue en Cardiologie interventionnelle"
                  example: "Dipl√¥me de Docteur en M√©decine - Universit√© d'Abidjan"
                
                type:
                  type: string
                  enum: [DIPLOME, CERTIFICATION, AUTRE]
                  description: |
                    Type de document m√©dical
                    
                    **Requis pour :** ADD
                    **Optionnel pour :** UPDATE (si changement de type)
                    
                    **Types :**
                    - **DIPLOME** : Dipl√¥mes universitaires, certificats d'√©tudes
                    - **CERTIFICATION** : Ordre des m√©decins, formations continues
                    - **AUTRE** : Autres documents m√©dicaux pertinents
                  example: "DIPLOME"
                
                description:
                  type: string
                  maxLength: 500
                  description: |
                    Description d√©taill√©e optionnelle
                    
                    **Usage :** Informations compl√©mentaires sur le document
                    **Exemple :** Date d'obtention, institution, sp√©cifications
                  example: "Dipl√¥me obtenu en juin 2020 avec mention Tr√®s Bien. Sp√©cialisation en m√©decine interne."
                
                document:
                  type: string
                  format: binary
                  description: |
                    Fichier document √† uploader
                    
                    **Requis pour :** ADD
                    **Optionnel pour :** UPDATE (si remplacement du fichier)
                    
                    **Contraintes :**
                    - **Formats accept√©s :** PDF, JPG, PNG uniquement
                    - **Taille maximale :** 10MB
                    - **Recommandation :** PDF pour documents officiels
            
            examples:
              ajouter_diplome:
                summary: Ajouter un dipl√¥me de m√©decine
                value:
                  action: "ADD"
                  libelle: "Dipl√¥me de Docteur en M√©decine - Universit√© d'Abidjan"
                  type: "DIPLOME"
                  description: "Dipl√¥me obtenu en juin 2020 avec mention Tr√®s Bien"
                  document: "[FICHIER_PDF]"
              
              ajouter_certification:
                summary: Ajouter une certification professionnelle
                value:
                  action: "ADD"
                  libelle: "Certificat d'inscription √† l'Ordre des M√©decins 2024"
                  type: "CERTIFICATION"
                  description: "Certificat valide jusqu'en d√©cembre 2024"
                  document: "[FICHIER_PDF]"
              
              modifier_libelle:
                summary: Modifier le libell√© d'un document existant
                value:
                  action: "UPDATE"
                  documentId: "a1b2c3d4e5f67890abcdef1234567890"
                  libelle: "Dipl√¥me de Docteur en M√©decine - Universit√© F√©lix Houphou√´t-Boigny"
                  description: "Mise √† jour du nom officiel de l'universit√©"
              
              remplacer_fichier:
                summary: Remplacer un fichier document
                value:
                  action: "UPDATE"
                  documentId: "a1b2c3d4e5f67890abcdef1234567890"
                  document: "[NOUVEAU_FICHIER_PDF]"
              
              supprimer_document:
                summary: Supprimer un document
                value:
                  action: "DELETE"
                  documentId: "a1b2c3d4e5f67890abcdef1234567890"
              
              lister_documents:
                summary: Lister tous les documents
                value:
                  action: "LIST"

          application/json:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  enum: [LIST]
                  description: Action LIST peut √™tre envoy√©e en JSON simple
            examples:
              lister_documents_json:
                summary: Lister documents (format JSON)
                value:
                  action: "LIST"

      responses:
        '200':
          description: Action sur les documents effectu√©e avec succ√®s
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                  data:
                    type: object
                    oneOf:
                      # Response pour LIST
                      - properties:
                          medecin:
                            type: object
                            properties:
                              id:
                                type: string
                                format: uuid
                              nom:
                                type: string
                              prenom:
                                type: string
                          documents:
                            type: object
                            properties:
                              diplomes:
                                type: array
                                items:
                                  $ref: '#/components/schemas/DocumentInfo'
                              certifications:
                                type: array
                                items:
                                  $ref: '#/components/schemas/DocumentInfo'
                          statistiques:
                            type: object
                            properties:
                              totalDiplomes:
                                type: integer
                              totalCertifications:
                                type: integer
                              total:
                                type: integer
                      
                      # Response pour ADD/UPDATE
                      - properties:
                          document:
                            $ref: '#/components/schemas/DocumentInfo'
                          medecin:
                            type: object
                            properties:
                              id:
                                type: string
                                format: uuid
                              nom:
                                type: string
                              prenom:
                                type: string
                          upload:
                            type: object
                            properties:
                              uploadedBy:
                                type: string
                              uploadedAt:
                                type: string
                                format: date-time
                              storageMode:
                                type: string
                                enum: [local, external]
                      
                      # Response pour DELETE
                      - properties:
                          deletedDocument:
                            type: object
                            properties:
                              documentId:
                                type: string
                              libelle:
                                type: string
                              type:
                                type: string
                              filename:
                                type: string
                          deleteInfo:
                            type: object
                            properties:
                              deletedBy:
                                type: string
                              deletedAt:
                                type: string
                                format: date-time
                              physicalFileDeleted:
                                type: boolean
                  timestamp:
                    type: string
                    format: date-time
              examples:
                liste_documents:
                  summary: Liste compl√®te des documents d'un m√©decin
                  value:
                    success: true
                    message: "Documents r√©cup√©r√©s avec succ√®s"
                    data:
                      medecin:
                        id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                        nom: "Diabat√©"
                        prenom: "Dr Fatou"
                      documents:
                        diplomes:
                          - documentId: "abc123def456ghi789"
                            libelle: "Dipl√¥me de Docteur en M√©decine - Universit√© d'Abidjan"
                            type: "DIPLOME"
                            description: "Dipl√¥me obtenu en juin 2020 avec mention Tr√®s Bien"
                            filename: "abc123def456ghi789.pdf"
                            size: 2048576
                            mimeType: "application/pdf"
                            uploadDate: "2024-01-10T09:15:30.123Z"
                            uploadedByAdminName: "Admin Marie Kouassi"
                          - documentId: "def456ghi789jkl012"
                            libelle: "Dipl√¥me de Sp√©cialisation en Cardiologie"
                            type: "DIPLOME"
                            description: "Sp√©cialisation obtenue √† Paris en 2022"
                            filename: "def456ghi789jkl012.pdf"
                            size: 1536000
                            mimeType: "application/pdf"
                            uploadDate: "2024-01-10T10:30:45.456Z"
                            uploadedByAdminName: "Admin Marie Kouassi"
                        certifications:
                          - documentId: "ghi789jkl012mno345"
                            libelle: "Certificat d'inscription √† l'Ordre des M√©decins 2024"
                            type: "CERTIFICATION"
                            description: "Certificat valide jusqu'en d√©cembre 2024"
                            filename: "ghi789jkl012mno345.pdf"
                            size: 512000
                            mimeType: "application/pdf"
                            uploadDate: "2024-01-11T14:20:15.789Z"
                            uploadedByAdminName: "Admin Jean Kouakou"
                      statistiques:
                        totalDiplomes: 2
                        totalCertifications: 1
                        total: 3
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                document_ajoute:
                  summary: Document ajout√© avec succ√®s
                  value:
                    success: true
                    message: "Document ajout√© avec succ√®s"
                    data:
                      document:
                        documentId: "new123doc456file789"
                        libelle: "Formation Continue en √âchographie Cardiaque"
                        type: "CERTIFICATION"
                        description: "Formation valid√©e par la Soci√©t√© de Cardiologie"
                        filename: "new123doc456file789.pdf"
                        size: 1024000
                        mimeType: "application/pdf"
                      medecin:
                        id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                        nom: "Diabat√©"
                        prenom: "Dr Fatou"
                      upload:
                        uploadedBy: "Admin Marie Kouassi"
                        uploadedAt: "2024-01-15T14:30:22.123Z"
                        storageMode: "local"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                document_mis_a_jour:
                  summary: Document mis √† jour avec succ√®s
                  value:
                    success: true
                    message: "Document mis √† jour avec succ√®s"
                    data:
                      document:
                        documentId: "abc123def456ghi789"
                        libelle: "Dipl√¥me de Docteur en M√©decine - Universit√© F√©lix Houphou√´t-Boigny"
                        type: "DIPLOME"
                        description: "Mise √† jour du nom officiel de l'universit√©"
                        filename: "abc123def456ghi789.pdf"
                        size: 2048576
                        mimeType: "application/pdf"
                        fileChanged: false
                      updateInfo:
                        updatedBy: "Admin Marie Kouassi"
                        updatedAt: "2024-01-15T14:30:22.123Z"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                document_supprime:
                  summary: Document supprim√© avec succ√®s
                  value:
                    success: true
                    message: "Document supprim√© avec succ√®s"
                    data:
                      deletedDocument:
                        documentId: "old123doc456todel"
                        libelle: "Ancien certificat obsol√®te"
                        type: "CERTIFICATION"
                        filename: "old123doc456todel.pdf"
                      deleteInfo:
                        deletedBy: "Admin Marie Kouassi"
                        deletedAt: "2024-01-15T14:30:22.123Z"
                        physicalFileDeleted: true
                    timestamp: "2024-01-15T14:30:22.123Z"

        '201':
          description: Document cr√©√© avec succ√®s (action ADD)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Document ajout√© avec succ√®s"
                  data:
                    type: object
                    properties:
                      document:
                        $ref: '#/components/schemas/DocumentInfo'
                      medecin:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          nom:
                            type: string
                          prenom:
                            type: string
                      upload:
                        type: object
                        properties:
                          uploadedBy:
                            type: string
                          uploadedAt:
                            type: string
                            format: date-time
                          storageMode:
                            type: string
                            enum: [local, external]

        '400':
          description: Requ√™te invalide - Param√®tres manquants ou incorrects
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                action_manquante:
                  summary: Action non sp√©cifi√©e
                  value:
                    success: false
                    error: "VALIDATION_ERROR"
                    message: "Param√®tres de requ√™te invalides"
                    details:
                      action: "Ce champ est obligatoire"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                action_invalide:
                  summary: Action non reconnue
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Action non reconnue"
                    details:
                      code: "INVALID_ACTION"
                      allowedActions: ["ADD", "UPDATE", "DELETE", "LIST"]
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                fichier_requis_add:
                  summary: Fichier requis pour ADD
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Fichier requis pour ajouter un document"
                    details:
                      code: "FILE_REQUIRED"
                      action: "ADD"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                libelle_requis_add:
                  summary: Libell√© requis pour ADD
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Libell√© requis pour ajouter un document"
                    details:
                      code: "LIBELLE_REQUIRED"
                      field: "libelle"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                document_id_requis:
                  summary: Document ID requis pour UPDATE/DELETE
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "ID du document requis pour la mise √† jour"
                    details:
                      code: "DOCUMENT_ID_REQUIRED"
                      action: "UPDATE"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                fichier_trop_volumineux:
                  summary: Fichier trop volumineux
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Fichier trop volumineux. Maximum: 10MB"
                    details:
                      code: "FILE_TOO_LARGE"
                      maxSize: "10MB"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                format_fichier_invalide:
                  summary: Format de fichier non autoris√©
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Format de fichier non autoris√©. Formats accept√©s: PDF, JPG, PNG"
                    details:
                      code: "INVALID_FILE_FORMAT"
                      allowedFormats: ["PDF", "JPG", "PNG"]
                    timestamp: "2024-01-15T14:30:22.123Z"

        '401':
          $ref: '#/components/responses/Unauthorized'

        '403':
          description: Acc√®s refus√© - R√©serv√© aux administrateurs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "FORBIDDEN"
                message: "Acc√®s r√©serv√© aux administrateurs"
                timestamp: "2024-01-15T14:30:22.123Z"

        '404':
          description: Ressource non trouv√©e
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                medecin_non_trouve:
                  summary: M√©decin non trouv√©
                  value:
                    success: false
                    error: "NOT_FOUND"
                    message: "M√©decin non trouv√©"
                    details:
                      code: "MEDECIN_NOT_FOUND"
                      medecinId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                document_non_trouve:
                  summary: Document non trouv√©
                  value:
                    success: false
                    error: "NOT_FOUND"
                    message: "Document non trouv√©"
                    details:
                      code: "DOCUMENT_NOT_FOUND"
                      documentId: "abc123def456ghi789"
                    timestamp: "2024-01-15T14:30:22.123Z"

        '500':
          description: Erreur serveur - Probl√®me de stockage ou traitement
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                erreur_service_fichiers:
                  summary: Erreur du service de fichiers
                  value:
                    success: false
                    error: "INTERNAL_SERVER_ERROR"
                    message: "Erreur lors de la gestion du fichier"
                    details:
                      code: "FILE_SERVICE_ERROR"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                erreur_generale:
                  summary: Erreur interne g√©n√©rale
                  value:
                    success: false
                    error: "INTERNAL_SERVER_ERROR"
                    message: "Erreur interne lors de la gestion des documents"
                    timestamp: "2024-01-15T14:30:22.123Z"

components:
  schemas:
    DocumentInfo:
      type: object
      description: Informations compl√®tes sur un document m√©dical
      properties:
        documentId:
          type: string
          description: ID unique du document pour les op√©rations
          example: "abc123def456ghi789"
        libelle:
          type: string
          description: Libell√© descriptif personnalis√©
          example: "Dipl√¥me de Docteur en M√©decine - Universit√© d'Abidjan"
        type:
          type: string
          enum: [DIPLOME, CERTIFICATION, AUTRE]
          description: Type de document m√©dical
          example: "DIPLOME"
        description:
          type: string
          nullable: true
          description: Description d√©taill√©e optionnelle
          example: "Dipl√¥me obtenu en juin 2020 avec mention Tr√®s Bien"
        filename:
          type: string
          description: Nom du fichier physique
          example: "abc123def456ghi789.pdf"
        size:
          type: integer
          description: Taille du fichier en bytes
          example: 2048576
        mimeType:
          type: string
          description: Type MIME du fichier
          example: "application/pdf"
        uploadDate:
          type: string
          format: date-time
          description: Date d'upload du document
          example: "2024-01-10T09:15:30.123Z"
        uploadedByAdminId:
          type: string
          format: uuid
          description: ID de l'admin qui a upload√©
          example: "b2c3d4e5-f6g7-8901-bcde-f12345678901"
        uploadedByAdminName:
          type: string
          description: Nom complet de l'admin qui a upload√©
          example: "Admin Marie Kouassi"
        lastUpdatedBy:
          type: string
          nullable: true
          description: Derni√®re modification par (si applicable)
          example: "Admin Jean Kouakou"
        lastUpdatedAt:
          type: string
          format: date-time
          nullable: true
          description: Date derni√®re modification (si applicable)
          example: "2024-01-12T16:45:20.456Z"

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "ERROR_CODE"
        message:
          type: string
          example: "Description de l'erreur"
        details:
          type: object
          additionalProperties: true
          description: D√©tails sp√©cifiques √† l'erreur
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T14:30:22.123Z"

  responses:
    Unauthorized:
      description: Non authentifi√© - Token manquant ou invalide
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error: "UNAUTHORIZED"
            message: "Token d'authentification requis"
            timestamp: "2024-01-15T14:30:22.123Z"

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Token JWT d'administrateur obtenu lors de la connexion.
        Format: `Authorization: Bearer <admin_token>`