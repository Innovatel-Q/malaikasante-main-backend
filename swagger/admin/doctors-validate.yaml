openapi: 3.0.0
info:
  title: Admin Doctors Validation API
  description: Validation ou rejet des m√©decins en attente par les administrateurs
  version: 1.0.0

paths:
  /v1/admin/doctors/{medecinId}/validate:
    put:
      tags:
        - Administration
      summary: Valider ou rejeter un m√©decin en attente
      description: |
        Permet aux administrateurs de valider ou rejeter un m√©decin en attente de validation.
        
        **Actions possibles :**
        - ‚úÖ **VALIDE** : Approuve le m√©decin qui peut alors se connecter
        - ‚ùå **REJETE** : Refuse le m√©decin avec un motif obligatoire
        
        **Cons√©quences de la validation :**
        - **Si VALIDE** : Le m√©decin peut se connecter avec email/password
        - **Si REJETE** : Le m√©decin reste EN_ATTENTE et re√ßoit le motif
        
        **Notifications automatiques :**
        - üìß **Email automatique** envoy√© au m√©decin selon l'action
        - üìä **Tra√ßabilit√©** : Admin, date, IP enregistr√©s
        - üìù **Audit trail** : Historique complet des actions
        
        **Workflow :**
        1. Admin examine les documents du m√©decin
        2. D√©cide de valider ou rejeter via cette route
        3. Syst√®me met √† jour le statut en base
        4. Email automatique envoy√© au m√©decin
        5. M√©decin peut se connecter (si valid√©) ou corriger (si rejet√©)
        
        **User Stories :** Administrateurs-US2, US3 (Gestion comptes m√©decins)

      security:
        - bearerAuth: []
      
      parameters:
        - name: medecinId
          in: path
          description: ID unique du m√©decin √† valider/rejeter
          required: true
          schema:
            type: string
            format: uuid
            example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  enum: [VALIDE, REJETE]
                  description: |
                    Action √† effectuer sur le m√©decin
                    
                    - **VALIDE** : Approuve le m√©decin
                    - **REJETE** : Refuse le m√©decin
                  example: "VALIDE"
                motifRejet:
                  type: string
                  minLength: 10
                  maxLength: 500
                  description: |
                    Motif du rejet (obligatoire si action = REJETE)
                    
                    **Exemples de motifs :**
                    - Documents illisibles ou incomplets
                    - Informations non conformes
                    - Dipl√¥mes non reconnus
                    - Certifications manquantes
                  example: "Documents illisibles, veuillez fournir des copies plus claires du dipl√¥me et du certificat d'inscription √† l'ordre"
            examples:
              validation:
                summary: Validation d'un m√©decin
                value:
                  action: "VALIDE"
              rejet_documents:
                summary: Rejet pour documents illisibles
                value:
                  action: "REJETE"
                  motifRejet: "Documents illisibles, veuillez fournir des copies plus claires du dipl√¥me et du certificat d'inscription √† l'ordre"
              rejet_formation:
                summary: Rejet pour formation non reconnue
                value:
                  action: "REJETE"
                  motifRejet: "Le dipl√¥me fourni ne correspond pas aux standards requis. Veuillez contacter l'administration pour plus d'informations"

      responses:
        '200':
          description: Action de validation effectu√©e avec succ√®s
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        enum: [VALIDE, REJETE]
                        example: "VALIDE"
                      message:
                        type: string
                        description: "Message d√©taill√© de confirmation"
                        example: "Dr Fatou Diabat√© a √©t√© valid√© et peut maintenant se connecter √† la plateforme."
                      motifRejet:
                        type: string
                        nullable: true
                        description: "Pr√©sent uniquement si action = REJETE"
                        example: null
                      nextSteps:
                        type: array
                        items:
                          type: string
                        description: "√âtapes suivantes selon l'action effectu√©e"
                        example: [
                          "Le m√©decin a re√ßu un email de confirmation",
                          "Il peut maintenant se connecter avec son email et mot de passe",
                          "Son profil est visible pour les patients",
                          "Il peut commencer √† recevoir des demandes de rendez-vous"
                        ]
                  timestamp:
                    type: string
                    format: date-time
                    example: "2024-01-15T14:30:22.123Z"
              examples:
                medecin_valide:
                  summary: M√©decin valid√© avec succ√®s
                  value:
                    success: true
                    message: "M√©decin valid√© avec succ√®s"
                    data:
                      status: "VALIDE"
                      message: "Dr Fatou Diabat√© a √©t√© valid√© et peut maintenant se connecter √† la plateforme."
                      nextSteps: [
                        "Le m√©decin a re√ßu un email de confirmation",
                        "Il peut maintenant se connecter avec son email et mot de passe",
                        "Son profil est visible pour les patients",
                        "Il peut commencer √† recevoir des demandes de rendez-vous"
                      ]
                    timestamp: "2024-01-15T14:30:22.123Z"

                medecin_rejete:
                  summary: M√©decin rejet√© avec motif
                  value:
                    success: true
                    message: "M√©decin rejet√© avec motif"
                    data:
                      status: "REJETE"
                      message: "Dr Jean Kouassi a √©t√© rejet√©. Un email avec le motif lui a √©t√© envoy√©."
                      motifRejet: "Documents illisibles, veuillez fournir des copies plus claires du dipl√¥me et du certificat d'inscription √† l'ordre"
                      nextSteps: [
                        "Le m√©decin a re√ßu un email avec le motif du rejet",
                        "Il peut corriger les probl√®mes mentionn√©s",
                        "Il doit contacter l'administration pour resoumission",
                        "Son statut reste EN_ATTENTE pour r√©vision future"
                      ]
                    timestamp: "2024-01-15T14:30:22.123Z"

        '400':
          description: Requ√™te invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                  message:
                    type: string
                  details:
                    type: object
              examples:
                action_manquante:
                  summary: Action non sp√©cifi√©e
                  value:
                    success: false
                    error: "VALIDATION_ERROR"
                    message: "Param√®tres de requ√™te invalides"
                    details:
                      action: "Ce champ est obligatoire"
                action_invalide:
                  summary: Action invalide
                  value:
                    success: false
                    error: "VALIDATION_ERROR"
                    message: "Param√®tres de requ√™te invalides"
                    details:
                      action: "La valeur doit √™tre VALIDE ou REJETE"
                motif_manquant:
                  summary: Motif requis pour rejet
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Motif de rejet obligatoire"
                    details:
                      code: "MOTIF_REQUIRED"
                      field: "motifRejet"
                motif_trop_court:
                  summary: Motif trop court
                  value:
                    success: false
                    error: "VALIDATION_ERROR"
                    message: "Param√®tres de requ√™te invalides"
                    details:
                      motifRejet: "Le motif doit contenir au moins 10 caract√®res"
                statut_invalide:
                  summary: M√©decin pas en attente
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Seuls les m√©decins en attente peuvent √™tre valid√©s"
                    details:
                      code: "INVALID_STATUS"
                      currentStatus: "VALIDE"

        '401':
          description: Non authentifi√©
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "UNAUTHORIZED"
                  message:
                    type: string
                    example: "Token d'authentification requis"

        '403':
          description: Acc√®s refus√© (r√¥le insuffisant)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "FORBIDDEN"
                  message:
                    type: string
                    example: "Acc√®s r√©serv√© aux administrateurs"

        '404':
          description: M√©decin non trouv√©
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "NOT_FOUND"
                  message:
                    type: string
                    example: "M√©decin non trouv√©"
                  details:
                    type: object
                    properties:
                      code:
                        type: string
                        example: "MEDECIN_NOT_FOUND"
                      medecinId:
                        type: string
                        example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"

        '500':
          description: Erreur serveur
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "INTERNAL_ERROR"
                  message:
                    type: string
                    example: "Erreur interne lors de la validation du m√©decin"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT