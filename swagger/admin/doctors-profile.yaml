openapi: 3.0.0
info:
  title: Admin Doctors Profile Update API
  description: Mise √† jour compl√®te des profils m√©decins par les administrateurs
  version: 1.0.0

paths:
  /v1/admin/doctors/{medecinId}/profile:
    put:
      tags:
        - Administration
      summary: Mettre √† jour le profil complet d'un m√©decin
      description: |
        Permet aux administrateurs de modifier toutes les informations d'un m√©decin valid√© ou en attente.
        
        **üîß Fonctionnalit√©s :**
        - ‚úÖ **Mise √† jour partielle** : Seuls les champs fournis sont modifi√©s
        - üîí **Validation stricte** : V√©rification d'unicit√© (email, t√©l√©phone, num√©ro d'ordre)
        - üõ°Ô∏è **S√©curit√©** : Hash automatique des mots de passe (bcrypt niveau 12)
        - üìä **Tra√ßabilit√© compl√®te** : Historique des modifications par admin
        
        **üìã Donn√©es modifiables :**
        
        **Informations utilisateur :**
        - Nom, pr√©nom, email, t√©l√©phone
        - Mot de passe (hashage automatique)
        
        **Informations m√©decin :**
        - Num√©ro d'ordre, sp√©cialit√©s, biographie
        - Ann√©es d'exp√©rience, langues parl√©es
        - Tarifs et types de consultation accept√©s
        - Association √† une clinique
        
        **üîÑ Workflow :**
        1. Admin identifie le m√©decin √† modifier
        2. Fournit les champs √† mettre √† jour (mise √† jour partielle)
        3. Syst√®me valide l'unicit√© des donn√©es critiques
        4. Transaction atomique : User + Medecin mis √† jour ensemble
        5. R√©ponse compl√®te avec donn√©es actualis√©es
        
        **‚ö†Ô∏è Contraintes de s√©curit√© :**
        - V√©rification d'unicit√© pour email, t√©l√©phone, num√©ro d'ordre
        - Validation des sp√©cialit√©s selon la liste officielle
        - Validation de l'existence de la clinique si sp√©cifi√©e
        - Tous les changements sont trac√©s (admin, date, IP)
        
        **User Stories :** Admin-US4, US5 (Gestion profils m√©decins)

      security:
        - bearerAuth: []
      
      parameters:
        - name: medecinId
          in: path
          description: ID unique du m√©decin √† modifier
          required: true
          schema:
            type: string
            format: uuid
            example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"

      requestBody:
        required: true
        description: |
          **Mise √† jour partielle** : Seuls les champs fournis seront modifi√©s.
          
          ‚ö†Ô∏è **IMPORTANT** : Tous les champs sont optionnels, permettant une mise √† jour cibl√©e.
        content:
          application/json:
            schema:
              type: object
              properties:
                # === DONN√âES UTILISATEUR ===
                nom:
                  type: string
                  minLength: 2
                  maxLength: 100
                  pattern: "^[A-Za-z√Ä-√ø\\-'\\s]+$"
                  description: |
                    Nom de famille du m√©decin
                    
                    **Contraintes :**
                    - 2-100 caract√®res
                    - Lettres, espaces, traits d'union et apostrophes uniquement
                  example: "Diabat√©"
                
                prenom:
                  type: string
                  minLength: 2
                  maxLength: 100
                  pattern: "^[A-Za-z√Ä-√ø\\-'\\s]+$"
                  description: |
                    Pr√©nom du m√©decin
                    
                    **Contraintes :**
                    - 2-100 caract√®res
                    - Lettres, espaces, traits d'union et apostrophes uniquement
                  example: "Dr Fatou"
                
                email:
                  type: string
                  format: email
                  maxLength: 255
                  description: |
                    Adresse email professionnelle
                    
                    **‚ö†Ô∏è Unicit√© requise** : V√©rifi√© automatiquement
                    **Format** : adresse email valide
                  example: "dr.fatou.diabate@clinique-abidjan.ci"
                
                telephone:
                  type: string
                  pattern: '^(\+225|0)[0-9]{8,10}$'
                  description: |
                    Num√©ro de t√©l√©phone ivoirien
                    
                    **‚ö†Ô∏è Unicit√© requise** : V√©rifi√© automatiquement
                    **Formats accept√©s :**
                    - `+225XXXXXXXX` (international)
                    - `0XXXXXXXXX` (national)
                  example: "+22507080910"
                
                password:
                  type: string
                  minLength: 8
                  maxLength: 100
                  description: |
                    Nouveau mot de passe (si modification souhait√©e)
                    
                    **S√©curit√© :**
                    - Hashage automatique bcrypt niveau 12
                    - Minimum 8 caract√®res
                    - Recommand√© : majuscules, chiffres, caract√®res sp√©ciaux
                  example: "NouveauMotDePasse2024!"
                
                # === DONN√âES M√âDECIN ===
                numeroOrdre:
                  type: string
                  minLength: 5
                  maxLength: 50
                  pattern: '^[A-Z0-9]+$'
                  description: |
                    Num√©ro d'inscription √† l'Ordre des M√©decins
                    
                    **‚ö†Ô∏è Unicit√© requise** : V√©rifi√© automatiquement
                    **Format** : Lettres majuscules et chiffres uniquement
                  example: "CI123456789"
                
                specialites:
                  type: array
                  items:
                    type: string
                    enum:
                      - MEDECINE_GENERALE
                      - CARDIOLOGIE
                      - DERMATOLOGIE
                      - PEDIATRIE
                      - GYNECOLOGIE
                      - NEUROLOGIE
                      - PSYCHIATRIE
                      - CHIRURGIE_GENERALE
                      - OPHTALMOLOGIE
                      - ORL
                      - RADIOLOGIE
                      - ANESTHESIE
                      - URGENCES
                      - MEDECINE_INTERNE
                      - ENDOCRINOLOGIE
                      - RHUMATOLOGIE
                      - GASTROENTEROLOGIE
                      - PNEUMOLOGIE
                      - NEPHROLOGIE
                      - ONCOLOGIE
                  minItems: 1
                  uniqueItems: true
                  description: |
                    Liste des sp√©cialit√©s m√©dicales officielles
                    
                    **Contraintes :**
                    - Au moins une sp√©cialit√© requise
                    - Pas de doublons
                    - Uniquement les sp√©cialit√©s de la liste officielle
                  example: ["CARDIOLOGIE", "MEDECINE_INTERNE"]
                
                bio:
                  type: string
                  maxLength: 1000
                  description: |
                    Biographie professionnelle du m√©decin
                    
                    **Usage :** Visible par les patients lors de la recherche
                    **Limite :** 1000 caract√®res maximum
                  example: "Cardiologue interventionnelle avec 15 ans d'exp√©rience. Sp√©cialis√©e en chirurgie cardiaque minimalement invasive et cardiologie pr√©ventive."
                
                experienceAnnees:
                  type: integer
                  minimum: 0
                  maximum: 60
                  description: |
                    Nombre d'ann√©es d'exp√©rience professionnelle
                    
                    **Plage valide :** 0-60 ans
                  example: 15
                
                languesParlees:
                  type: array
                  items:
                    type: string
                    enum: [FRANCAIS, ANGLAIS, BAOUL√â, DIOULA, B√âT√â, YACOUBA, S√âNOUFO, AUTRES]
                  uniqueItems: true
                  description: |
                    Langues parl√©es par le m√©decin
                    
                    **Usage :** Facilite la communication avec les patients
                    **Par d√©faut :** FRANCAIS inclus automatiquement
                  example: ["FRANCAIS", "DIOULA", "ANGLAIS"]
                
                tarifConsultationBase:
                  type: number
                  multipleOf: 0.01
                  minimum: 0
                  maximum: 1000000
                  description: |
                    Tarif de base pour une consultation (en FCFA)
                    
                    **Format :** D√©cimal avec 2 d√©cimales max
                    **Usage :** Affich√© aux patients lors de la r√©servation
                  example: 25000.00
                
                # === TYPES DE CONSULTATION ===
                accepteDomicile:
                  type: boolean
                  description: |
                    Le m√©decin accepte-t-il les consultations √† domicile ?
                    
                    **Impact :** Affich√© dans les filtres de recherche patients
                  example: true
                
                accepteTeleconsultation:
                  type: boolean
                  description: |
                    Le m√©decin accepte-t-il les t√©l√©consultations ?
                    
                    **Impact :** Option visible lors de la prise de rendez-vous
                  example: true
                
                accepteclinique:
                  type: boolean
                  description: |
                    Le m√©decin accepte-t-il les consultations en clinique ?
                    
                    **Par d√©faut :** true (la plupart des m√©decins)
                  example: true
                
                cliniqueId:
                  type: string
                  format: uuid
                  nullable: true
                  description: |
                    ID de la clinique principale d'exercice
                    
                    **‚ö†Ô∏è Validation :** Existence de la clinique v√©rifi√©e
                    **Nullable :** Peut √™tre null si exercice lib√©ral uniquement
                  example: "b2c3d4e5-f6g7-8901-bcde-f12345678901"

            examples:
              mise_a_jour_complete:
                summary: Mise √† jour compl√®te d'un cardiologue
                description: Exemple de modification de toutes les informations d'un m√©decin
                value:
                  nom: "Diabat√©-Kouassi"
                  prenom: "Dr Fatou Marie"
                  email: "dr.fatou.diabate@nouveauclinic.ci"
                  telephone: "+22507080911"
                  numeroOrdre: "CI987654321"
                  specialites: ["CARDIOLOGIE", "MEDECINE_INTERNE", "URGENCES"]
                  bio: "Cardiologue interventionnelle avec 15 ans d'exp√©rience. Experte en cardiologie p√©diatrique et chirurgie cardiaque minimalement invasive. Dipl√¥m√©e de l'Universit√© d'Abidjan et de l'H√¥pital europ√©en de Paris."
                  experienceAnnees: 15
                  languesParlees: ["FRANCAIS", "ANGLAIS", "DIOULA"]
                  tarifConsultationBase: 35000.00
                  accepteDomicile: true
                  accepteTeleconsultation: true
                  accepteclinique: true
                  cliniqueId: "b2c3d4e5-f6g7-8901-bcde-f12345678901"
              
              mise_a_jour_partielle_info:
                summary: Mise √† jour partielle - Informations personnelles
                description: Modification uniquement du nom, email et t√©l√©phone
                value:
                  nom: "Nouveau-Nom"
                  email: "nouveau.email@clinique.ci"
                  telephone: "+22501234567"
              
              mise_a_jour_partielle_medical:
                summary: Mise √† jour partielle - Informations m√©dicales
                description: Modification des sp√©cialit√©s et tarifs uniquement
                value:
                  specialites: ["PEDIATRIE", "MEDECINE_GENERALE"]
                  tarifConsultationBase: 20000.00
                  bio: "P√©diatre g√©n√©raliste sp√©cialis√© dans le suivi de l'enfant et de l'adolescent."
              
              changement_password:
                summary: Changement de mot de passe uniquement
                description: Modification s√©curis√©e du mot de passe
                value:
                  password: "NouveauMotDePasseSecurise2024!"
              
              association_clinique:
                summary: Association √† une nouvelle clinique
                description: Changement de clinique principale d'exercice
                value:
                  cliniqueId: "c3d4e5f6-g7h8-9012-cdef-123456789012"
                  accepteclinique: true
                  tarifConsultationBase: 30000.00

      responses:
        '200':
          description: Profil m√©decin mis √† jour avec succ√®s
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Profil m√©decin mis √† jour avec succ√®s"
                  data:
                    type: object
                    properties:
                      medecin:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                            example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                          user:
                            type: object
                            properties:
                              id:
                                type: string
                                format: uuid
                                example: "b2c3d4e5-f6g7-8901-bcde-f12345678901"
                              nom:
                                type: string
                                example: "Diabat√©"
                              prenom:
                                type: string
                                example: "Dr Fatou"
                              email:
                                type: string
                                format: email
                                example: "dr.fatou.diabate@clinique-abidjan.ci"
                              telephone:
                                type: string
                                example: "+22507080910"
                              role:
                                type: string
                                enum: [MEDECIN]
                                example: "MEDECIN"
                              statut:
                                type: string
                                enum: [ACTIF, SUSPENDU, DESACTIVE]
                                example: "ACTIF"
                          numeroOrdre:
                            type: string
                            example: "CI123456789"
                          specialites:
                            type: array
                            items:
                              type: string
                            example: ["CARDIOLOGIE", "MEDECINE_INTERNE"]
                          statutValidation:
                            type: string
                            enum: [EN_ATTENTE, VALIDE, REJETE]
                            example: "VALIDE"
                          bio:
                            type: string
                            nullable: true
                            example: "Cardiologue interventionnelle avec 15 ans d'exp√©rience."
                          experienceAnnees:
                            type: integer
                            nullable: true
                            example: 15
                          languesParlees:
                            type: array
                            items:
                              type: string
                            example: ["FRANCAIS", "DIOULA", "ANGLAIS"]
                          tarifConsultationBase:
                            type: number
                            nullable: true
                            example: 25000.00
                          accepteDomicile:
                            type: boolean
                            example: true
                          accepteTeleconsultation:
                            type: boolean
                            example: true
                          accepteclinique:
                            type: boolean
                            example: true
                          noteMoyenne:
                            type: number
                            format: float
                            example: 4.7
                          nombreEvaluations:
                            type: integer
                            example: 127
                          clinique:
                            type: object
                            nullable: true
                            properties:
                              id:
                                type: string
                                format: uuid
                                example: "c3d4e5f6-g7h8-9012-cdef-123456789012"
                              nom:
                                type: string
                                example: "Clinique Internationale d'Abidjan"
                              ville:
                                type: string
                                example: "Abidjan"
                      updateInfo:
                        type: object
                        description: Informations sur la mise √† jour effectu√©e
                        properties:
                          fieldsUpdated:
                            type: array
                            items:
                              type: string
                            description: Liste des champs qui ont √©t√© modifi√©s
                            example: ["user.email", "user.telephone", "medecin.specialites", "medecin.bio"]
                          updatedBy:
                            type: string
                            description: Admin qui a effectu√© la modification
                            example: "Admin Marie Kouassi"
                          updatedAt:
                            type: string
                            format: date-time
                            example: "2024-01-15T14:30:22.123Z"
                          ip:
                            type: string
                            description: Adresse IP de l'admin
                            example: "192.168.1.100"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2024-01-15T14:30:22.123Z"
              examples:
                profil_mis_a_jour:
                  summary: Profil mis √† jour avec succ√®s
                  value:
                    success: true
                    message: "Profil m√©decin mis √† jour avec succ√®s"
                    data:
                      medecin:
                        id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                        user:
                          id: "b2c3d4e5-f6g7-8901-bcde-f12345678901"
                          nom: "Diabat√©"
                          prenom: "Dr Fatou"
                          email: "dr.fatou.diabate@clinique-abidjan.ci"
                          telephone: "+22507080910"
                          role: "MEDECIN"
                          statut: "ACTIF"
                        numeroOrdre: "CI123456789"
                        specialites: ["CARDIOLOGIE", "MEDECINE_INTERNE"]
                        statutValidation: "VALIDE"
                        bio: "Cardiologue interventionnelle avec 15 ans d'exp√©rience."
                        experienceAnnees: 15
                        languesParlees: ["FRANCAIS", "DIOULA", "ANGLAIS"]
                        tarifConsultationBase: 25000.00
                        accepteDomicile: true
                        accepteTeleconsultation: true
                        accepteclinique: true
                        noteMoyenne: 4.7
                        nombreEvaluations: 127
                        clinique:
                          id: "c3d4e5f6-g7h8-9012-cdef-123456789012"
                          nom: "Clinique Internationale d'Abidjan"
                          ville: "Abidjan"
                      updateInfo:
                        fieldsUpdated: ["user.email", "user.telephone", "medecin.specialites", "medecin.bio"]
                        updatedBy: "Admin Marie Kouassi"
                        updatedAt: "2024-01-15T14:30:22.123Z"
                        ip: "192.168.1.100"
                    timestamp: "2024-01-15T14:30:22.123Z"

        '400':
          description: Requ√™te invalide - Donn√©es malform√©es ou contraintes viol√©es
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                validation_champs:
                  summary: Erreurs de validation des champs
                  value:
                    success: false
                    error: "VALIDATION_ERROR"
                    message: "Param√®tres de requ√™te invalides"
                    details:
                      nom: "Le nom doit contenir entre 2 et 100 caract√®res"
                      email: "Format d'email invalide"
                      specialites: "Au moins une sp√©cialit√© est requise"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                email_deja_utilise:
                  summary: Email d√©j√† utilis√© par un autre utilisateur
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Adresse email d√©j√† utilis√©e"
                    details:
                      code: "EMAIL_ALREADY_EXISTS"
                      field: "email"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                telephone_deja_utilise:
                  summary: Num√©ro de t√©l√©phone d√©j√† utilis√©
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Num√©ro de t√©l√©phone d√©j√† utilis√©"
                    details:
                      code: "PHONE_ALREADY_EXISTS"
                      field: "telephone"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                numero_ordre_deja_utilise:
                  summary: Num√©ro d'ordre d√©j√† utilis√©
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Num√©ro d'ordre d√©j√† utilis√©"
                    details:
                      code: "ORDRE_NUMBER_EXISTS"
                      field: "numeroOrdre"
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                specialites_invalides:
                  summary: Sp√©cialit√©s non reconnues
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Sp√©cialit√©s non reconnues"
                    details:
                      code: "INVALID_SPECIALITES"
                      message: "Les sp√©cialit√©s suivantes ne sont pas reconnues: INVALID_SPEC, UNKNOWN_SPEC"
                      field: "specialites"
                      specialitesAutorisees: ["MEDECINE_GENERALE", "CARDIOLOGIE", "PEDIATRIE"]
                    timestamp: "2024-01-15T14:30:22.123Z"
                
                clinique_non_trouvee:
                  summary: Clinique sp√©cifi√©e non trouv√©e
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Clinique non trouv√©e"
                    details:
                      code: "CLINIQUE_NOT_FOUND"
                      field: "cliniqueId"
                    timestamp: "2024-01-15T14:30:22.123Z"

        '401':
          $ref: '#/components/responses/Unauthorized'

        '403':
          description: Acc√®s refus√© - R√©serv√© aux administrateurs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "FORBIDDEN"
                message: "Acc√®s r√©serv√© aux administrateurs"
                timestamp: "2024-01-15T14:30:22.123Z"

        '404':
          description: M√©decin non trouv√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "NOT_FOUND"
                message: "M√©decin non trouv√©"
                details:
                  code: "MEDECIN_NOT_FOUND"
                  medecinId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                timestamp: "2024-01-15T14:30:22.123Z"

        '500':
          $ref: '#/components/responses/ServerError'

components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "ERROR_CODE"
        message:
          type: string
          example: "Description de l'erreur"
        details:
          type: object
          additionalProperties: true
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T14:30:22.123Z"

  responses:
    Unauthorized:
      description: Non authentifi√© - Token manquant ou invalide
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error: "UNAUTHORIZED"
            message: "Token d'authentification requis"
            timestamp: "2024-01-15T14:30:22.123Z"

    ServerError:
      description: Erreur interne du serveur
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error: "INTERNAL_SERVER_ERROR"
            message: "Erreur interne lors de la mise √† jour du profil m√©decin"
            timestamp: "2024-01-15T14:30:22.123Z"

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Token JWT d'administrateur obtenu lors de la connexion.
        Format: `Authorization: Bearer <admin_token>`