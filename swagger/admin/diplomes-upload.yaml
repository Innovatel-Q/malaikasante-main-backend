openapi: 3.0.0
info:
  title: Admin Doctors Diplomes Upload API
  description: Upload des dipl√¥mes de m√©decins par les administrateurs
  version: 1.0.0

paths:
  /v1/admin/doctors/{medecinId}/diplomes/upload:
    post:
      tags:
        - Administration
      summary: Upload d'un dipl√¥me de m√©decin
      description: |
        Permet aux administrateurs d'uploader un dipl√¥me pour un m√©decin en attente de validation.
        
        **Fonctionnalit√©s :**
        - üì§ **Upload s√©curis√©** via service de fichiers externe
        - üìã **Support multi-dipl√¥mes** : Ajoute sans √©craser les existants
        - üîí **Validation stricte** : M√©decin EN_ATTENTE uniquement
        - üìä **Tra√ßabilit√© compl√®te** : Admin, IP, horodatage
        - üìÅ **Formats accept√©s** : PDF, JPG, PNG (max 10MB)
        
        **Workflow :**
        1. Admin s√©lectionne un m√©decin en attente
        2. Upload le dipl√¥me via cette route
        3. Fichier stock√© dans le service externe
        4. M√©tadonn√©es ajout√©es au tableau JSON existant
        
        **User Stories :** Administrateurs-US1 (Gestion comptes m√©decins)

      security:
        - bearerAuth: []
      
      parameters:
        - name: medecinId
          in: path
          description: ID unique du m√©decin
          required: true
          schema:
            type: string
            format: uuid
            example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"

      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - diplome
              properties:
                diplome:
                  type: string
                  format: binary
                  description: |
                    Fichier dipl√¥me √† uploader
                    
                    **Formats accept√©s :** PDF, JPG, PNG
                    
                    **Taille max :** 10MB
                description:
                  type: string
                  maxLength: 255
                  description: Description optionnelle du dipl√¥me
                  example: "Dipl√¥me de m√©decine g√©n√©rale - Universit√© d'Abidjan"
            examples:
              diplome_principal:
                summary: Dipl√¥me principal de m√©decine
                value:
                  diplome: "[FICHIER_PDF]"
                  description: "Dipl√¥me de Docteur en M√©decine"
              specialisation:
                summary: Dipl√¥me de sp√©cialisation
                value:
                  diplome: "[FICHIER_PDF]"
                  description: "Certificat de sp√©cialisation en Cardiologie"

      responses:
        '200':
          description: Dipl√¥me upload√© avec succ√®s
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Dipl√¥me upload√© avec succ√®s"
                  data:
                    type: object
                    properties:
                      medecin:
                        type: object
                        properties:
                          id:
                            type: string
                            example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                          nom:
                            type: string
                            example: "Diabat√©"
                          prenom:
                            type: string
                            example: "Dr Fatou"
                          email:
                            type: string
                            example: "dr.fatou@example.com"
                      diplome:
                        type: object
                        properties:
                          fileId:
                            type: string
                            example: "file-uuid-12345"
                            description: "ID du fichier dans le service externe"
                          nom_fichier:
                            type: string
                            example: "diplome_medecine.pdf"
                          taille:
                            type: integer
                            example: 2048000
                            description: "Taille en bytes"
                          mime_type:
                            type: string
                            example: "application/pdf"
                          description:
                            type: string
                            nullable: true
                            example: "Dipl√¥me de m√©decine g√©n√©rale"
                      statistiques:
                        type: object
                        properties:
                          totalDiplomes:
                            type: integer
                            example: 2
                            description: "Nombre total de dipl√¥mes apr√®s ajout"
                          nouveauDiplome:
                            type: boolean
                            example: true
                      upload:
                        type: object
                        properties:
                          uploadedBy:
                            type: string
                            example: "Admin Pierre Kouassi"
                          uploadedAt:
                            type: string
                            format: date-time
                            example: "2024-01-15T14:30:22.123Z"
                          ip:
                            type: string
                            example: "192.168.1.100"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2024-01-15T14:30:22.123Z"
              examples:
                premier_diplome:
                  summary: Premier dipl√¥me upload√©
                  value:
                    success: true
                    message: "Dipl√¥me upload√© avec succ√®s"
                    data:
                      medecin:
                        id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                        nom: "Diabat√©"
                        prenom: "Dr Fatou"
                        email: "dr.fatou@example.com"
                      diplome:
                        fileId: "file-uuid-12345"
                        nom_fichier: "diplome_medecine.pdf"
                        taille: 2048000
                        mime_type: "application/pdf"
                        description: "Dipl√¥me de m√©decine g√©n√©rale"
                      statistiques:
                        totalDiplomes: 1
                        nouveauDiplome: true
                      upload:
                        uploadedBy: "Admin Pierre Kouassi"
                        uploadedAt: "2024-01-15T14:30:22.123Z"
                        ip: "192.168.1.100"
                    timestamp: "2024-01-15T14:30:22.123Z"

                diplome_supplementaire:
                  summary: Dipl√¥me suppl√©mentaire (sp√©cialisation)
                  value:
                    success: true
                    message: "Dipl√¥me upload√© avec succ√®s"
                    data:
                      medecin:
                        id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                        nom: "Diabat√©"
                        prenom: "Dr Fatou"
                        email: "dr.fatou@example.com"
                      diplome:
                        fileId: "file-uuid-67890"
                        nom_fichier: "specialisation_cardiologie.pdf"
                        taille: 1536000
                        mime_type: "application/pdf"
                        description: "Certificat de sp√©cialisation en Cardiologie"
                      statistiques:
                        totalDiplomes: 2
                        nouveauDiplome: true
                      upload:
                        uploadedBy: "Admin Pierre Kouassi"
                        uploadedAt: "2024-01-15T14:45:10.456Z"
                        ip: "192.168.1.100"
                    timestamp: "2024-01-15T14:45:10.456Z"

        '400':
          description: Requ√™te invalide
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                  message:
                    type: string
                  details:
                    type: object
              examples:
                no_file:
                  summary: Aucun fichier fourni
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Aucun fichier dipl√¥me fourni"
                    details:
                      code: "NO_FILE"
                      field: "diplome"
                file_too_large:
                  summary: Fichier trop volumineux
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Fichier trop volumineux. Maximum: 10MB"
                    details:
                      code: "FILE_TOO_LARGE"
                      maxSize: "10MB"
                invalid_format:
                  summary: Format de fichier non autoris√©
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Format de fichier non autoris√©. Formats accept√©s: PDF, JPG, PNG"
                invalid_status:
                  summary: M√©decin pas en attente
                  value:
                    success: false
                    error: "BAD_REQUEST"
                    message: "Seuls les m√©decins en attente peuvent recevoir des documents"
                    details:
                      code: "INVALID_STATUS"
                      currentStatus: "VALIDE"

        '401':
          description: Non authentifi√©
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "UNAUTHORIZED"
                  message:
                    type: string
                    example: "Token d'authentification requis"

        '403':
          description: Acc√®s refus√© (r√¥le insuffisant)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "FORBIDDEN"
                  message:
                    type: string
                    example: "Acc√®s r√©serv√© aux administrateurs"

        '404':
          description: M√©decin non trouv√©
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "NOT_FOUND"
                  message:
                    type: string
                    example: "M√©decin non trouv√©"
                  details:
                    type: object
                    properties:
                      code:
                        type: string
                        example: "MEDECIN_NOT_FOUND"
                      medecinId:
                        type: string
                        example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"

        '500':
          description: Erreur serveur
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                  message:
                    type: string
              examples:
                upload_service_error:
                  summary: Erreur service de fichiers
                  value:
                    success: false
                    error: "INTERNAL_ERROR"
                    message: "Erreur lors de l'upload du fichier"
                    details:
                      code: "UPLOAD_SERVICE_ERROR"
                general_error:
                  summary: Erreur g√©n√©rale
                  value:
                    success: false
                    error: "INTERNAL_ERROR"
                    message: "Erreur interne lors de l'upload du dipl√¥me"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT